# 카카오 알림톡 템플릿 모음

이 폴더에는 카카오 비즈니스 채널에 등록할 알림톡 템플릿들이 저장되어 있습니다.

## 파일 네이밍 규칙
- `01_호스트_등록완료.txt` - 번호_한글설명.txt

## 변수 규칙
카카오 알림톡에서는 `#{변수명}` 형태로 변수를 사용합니다.
- `#{date}` : 날짜 (예: 2월 3일)
- `#{time}` : 시간 (예: 19:00)

## 등록 시 참고사항
1. 카카오 비즈니스 채널 관리자센터 접속
2. 알림톡 > 템플릿 관리 > 템플릿 등록
3. 승인까지 1~3 영업일 소요
4. 승인 후 템플릿 ID를 .env.local에 설정

---

## 🆕 공개방 / 비공개방 시스템

### 📸 공개방 (isPublicRoom = true)
- 호스트가 등록 시 "공개방"으로 설정
- 1차 매칭 시 양팀 인스타그램 정보가 알림톡으로 교환됨
- 양팀이 상대 인스타를 확인 후 "진행/중단" 선택
- 양팀 모두 "진행" 선택 → 최종 매칭 확정
- 한쪽이라도 "중단" 선택 → 매칭 취소, 슬롯 초기화

### 🔒 비공개방 (isPublicRoom = false, 기본값)
- 1차 매칭 = 최종 매칭 (인스타 교환 없이 바로 진행)
- 알림톡 11번 (최종 매칭 완료) 즉시 발송

---

## 📋 템플릿 목록

### 🟢 예약/등록 단계 (01~03)

| 번호 | 파일명 | 설명 | 환경변수 |
|------|--------|------|----------|
| 01 | 호스트_등록완료 | 빈 슬롯에 호스트 등록 시 | VITE_TEMPLATE_HOST_REGISTERED |
| 02 | 게스트_신청완료 | 게스트가 매칭 신청 시 (게스트에게) | VITE_TEMPLATE_GUEST_APPLIED |
| 03 | 호스트_새신청알림 | 새 게스트 신청 시 (호스트에게) | VITE_TEMPLATE_HOST_NEW_APPLICANT |

### 🟡 1차 매칭 단계 (04~05)

| 번호 | 파일명 | 설명 | 환경변수 |
|------|--------|------|----------|
| 04 | 공개방_1차매칭_인스타교환 | 📸 공개방 전용: 1차 매칭 시 인스타 정보 교환 | VITE_TEMPLATE_PUBLIC_ROOM_FIRST_MATCH |
| 05 | 매칭_미선택알림 | 선택받지 못한 게스트에게 | VITE_TEMPLATE_NOT_SELECTED |

### 🔵 정보 교환 단계 (06~09) - ⚠️ 비공개방 전용 (DEPRECATED)

> **참고**: 06~09번 템플릿은 공개방 시스템 도입 전 사용되던 템플릿입니다.
> 현재는 `archive/` 폴더에 백업되어 있으며, 비공개방에서도 사용하지 않습니다.

| 번호 | 파일명 | 설명 | 환경변수 |
|------|--------|------|----------|
| 06 | (archive) | 정보 열람 결제 안내 | VITE_TEMPLATE_PAYMENT_REQUEST |
| 07 | (archive) | 정보 전달 및 진행 확인 | VITE_TEMPLATE_INFO_DELIVERED |
| 08 | (archive) | 정보 비공개 진행 확인 | VITE_TEMPLATE_INFO_DENIED_CONTINUE |
| 09 | (archive) | 상대팀 프로세스 대기 | VITE_TEMPLATE_WAIT_OTHER_TEAM |

### 🟣 최종 매칭 단계 (10~11, 20, 22)

| 번호 | 파일명 | 설명 | 환경변수 |
|------|--------|------|----------|
| 10 | 최종매칭_결제안내 | 양팀 진행 동의 후 **최종 매칭 결제** 안내 | VITE_TEMPLATE_FINAL_PAYMENT_REQUEST |
| 11 | 최종매칭_완료 | 🔒 비공개방: 1차매칭=최종매칭 완료 | VITE_TEMPLATE_FINAL_MATCH_COMPLETE |
| 20 | 매칭_리마인더_D-1 | 확정된 매칭 1일 전 안내 (예약발송) | VITE_TEMPLATE_MATCH_REMINDER |
| 22 | 선택시간_안내 | 매칭 시작 40분 후 선택 시간 안내 (예약발송) | VITE_TEMPLATE_DECISION_TIME |

### 🔴 취소/환불/반려 단계 (12~21)

| 번호 | 파일명 | 설명 | 환경변수 |
|------|--------|------|----------|
| 12 | 프로세스중_매칭취소 | 1차 매칭 후 프로세스 중 취소 (양팀에게) | VITE_TEMPLATE_PROCESS_CANCELLED |
| 13 | 호스트_개인사정취소 | 호스트 개인 사정 취소 (전체에게) | VITE_TEMPLATE_HOST_CANCELLED_ALL |
| 14 | 게스트_1차후취소_본인알림 | 1차 후 게스트 취소 (본인에게) | VITE_TEMPLATE_GUEST_CANCELLED_AFTER_FIRST |
| 15 | 게스트_1차후취소_호스트알림 | 1차 후 게스트 취소 (호스트에게) | VITE_TEMPLATE_GUEST_CANCELLED_HOST_NOTIFY |
| 16 | 게스트_1차전취소_본인알림 | 1차 전 게스트 취소 (본인에게) | VITE_TEMPLATE_GUEST_CANCELLED_BEFORE_FIRST |
| 17 | 게스트_1차전취소_호스트알림 | 1차 전 게스트 취소 (호스트에게) | VITE_TEMPLATE_GUEST_CANCELLED_BEFORE_HOST_NOTIFY |
| 18 | 취소_환불안내 | 최종 매칭 후 취소 (환불 대상) | VITE_TEMPLATE_REFUND_GUIDE |
| 19 | 취소_환불불가 | 최종 매칭 후 48h 내 취소 (환불 불가) | VITE_TEMPLATE_NO_REFUND_NOTICE |
| 21 | 학생증_반려_알림 | 학생증 인증 반려 시 | VITE_TEMPLATE_STUDENT_ID_REJECTED |

---

## 🔄 매칭 프로세스 플로우 (NEW)

```
[호스트 등록] → 01 발송
     │
     ├─ (부적절한 학생증) → 21 발송 (삭제)
     ↓
[게스트 신청] → 02 (게스트에게) + 03 (호스트에게) 발송
     ↓
[호스트가 게스트 선택 = 1차 매칭]
     ↓
  ├─→ 미선택 게스트들: 05 발송
  │
  ├─→ 📸 공개방 (isPublicRoom = true)
  │    ↓
  │    04 발송 (양팀 인스타 정보 포함)
  │    ↓
  │    [양팀 응답 대기: PENDING]
  │    ↓
  │    ├─ 양팀 "진행" → 11 발송 (최종 매칭 완료)
  │    └─ 한쪽 "중단" → 12 발송 (매칭 취소) → 슬롯 초기화
  │
  └─→ 🔒 비공개방 (isPublicRoom = false)
       ↓
       11 발송 (바로 최종 매칭 완료)

[매칭 완료 후]
     ↓
[D-1] → 20 (리마인더)
[+40분] → 22 (선택 시간 안내: 여성-대기, 남성-이동)

[취소 및 환불 안내]
  ├─ 1차 매칭 전 취소
  │    ├─ 게스트 취소: 16 (본인) + 17 (호스트)
  │    └─ 호스트 취소: 13 (전체)
  │
  ├─ 1차 매칭 후 ~ 최종 전 취소 (공개방만 해당)
  │    ├─ 게스트 취소: 14 (본인) + 15 (호스트)
  │    └─ 호스트/프로세스 취소: 12 (양팀)
  │
  └─ 최종 매칭 후 취소
       ├─ 48시간 이전 (전액 환불): 18 (양팀)
       └─ 48시간 이내 (페널티): 19 (취소팀) + 18 (상대팀)
```

---

## 📁 Archive 폴더

`archive/` 폴더에는 더 이상 사용하지 않는 구버전 템플릿들이 백업되어 있습니다:
- `04_1차매칭_완료안내.txt` - 구버전 1차 매칭 알림
- `06_정보열람_결제안내.txt` - 정보 교환 프로세스용
- `07_정보전달_진행확인.txt` - 정보 교환 프로세스용
- `08_정보비공개_진행확인.txt` - 정보 교환 프로세스용
- `09_상대팀_프로세스대기.txt` - 정보 교환 프로세스용

---

## 💰 결제 종류 (간소화됨)

1. ~~**정보 열람 결제 (06)**: 상대팀 인스타 아이디 확인용 (선택적)~~ → **제거됨**
2. **최종 매칭 결제 (10)**: 실제 만남 진행 확정용 (필수) → **공개방에서만 사용**
3. **비공개방**: 결제 없이 바로 최종 매칭 확정
